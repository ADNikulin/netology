# 12.5. Реляционные базы данных и администрирование баз данных — Никулин Александр
# Домашнее задание к занятиям «Репликация и масштабирование»

### Задание 1

Выполните конфигурацию master-slave репликации, примером можно пользоваться из лекции.

*Приложите скриншоты конфигурации, выполнения работы: состояния и режимы работы серверов.*

### Решение

<details>
  <sammary>Подробные сведения</sammary>

  - Не стал особо заморачиваться с версиями, тонкостями, конфигами и хранением секретов, взял за основу урок и пошерстил инеты.
  - Целью было поднять несколько баз через docker-compose и настроить минимальные БД с работающей репликой. 
  - Развернул на одной машине в яоблаке 2 инстанса БД.
  - `docker-compose.yaml`
    ```
    version: '3.7'

    services:
        mysql:
            image: 'percona:8.0'
            container_name: db-master
            volumes:
                - ./mysql-conf/master/mysql.conf:/etc/my.cnf.d/repl.cnf
                - ./mysql-conf/master/master.sql:/docker-entrypoint-initdb.d/start.sql
            environment:
                MYSQL_ROOT_PASSWORD: "secret"
    
        mysqlread:
            image: 'percona:8.0'
            container_name: db-slave
            volumes:
                - ./mysql-conf/slave/mysql.conf:/etc/my.cnf.d/repl.cnf
                - ./mysql-conf/slave/slave.sql:/docker-entrypoint-initdb.d/start.sql
            depends_on:
                - mysql
            environment:
                MYSQL_ROOT_PASSWORD: "secret"

    ```
    - конфиги:
      - `master mysql.conf`
        ```
        [mysqld]
        server-id=1
        binlog_format=ROW
        log-bin
        ```
      - `slave mysql.conf`
        ```
        [mysqld]
        server-id=2
        ```
      - `start master.sql`
        ```sql
        CREATE USER repl@'%' IDENTIFIED WITH mysql_native_password BY 'slavepass';
        GRANT REPLICATION SLAVE ON *.* TO repl@'%';
        ```
      - `slave master.sql`
        ```sql
        CHANGE MASTER TO MASTER_HOST='db-master', MASTER_USER='repl', MASTER_PASSWORD='slavepass';
        ```
    - ![image](https://github.com/ADNikulin/netology/assets/44374132/d538adaf-d313-4115-b83b-63f357d364c7)
    - master:\
      ![image](https://github.com/ADNikulin/netology/assets/44374132/a2aa0dd6-dad1-4855-960a-d10c9162b1f9)
    - slave:\
      ![image](https://github.com/ADNikulin/netology/assets/44374132/7f28c5c7-a7a1-4c34-877c-89bdaeae9ce1)
      ![image](https://github.com/ADNikulin/netology/assets/44374132/27efa56d-dace-4d8d-a762-659099da70a7)

    - Пример репликации: 
    - master: \
      ![image](https://github.com/ADNikulin/netology/assets/44374132/03575297-b239-405c-a3c7-50a554532832)
    - slave: \
      ![image](https://github.com/ADNikulin/netology/assets/44374132/c1371c85-22d3-4013-b1a1-020de887f4e9)

</details>

---

### Задание 2

Разработайте план для выполнения горизонтального и вертикального шаринга базы данных. База данных состоит из трёх таблиц: 

- пользователи, 
- книги, 
- магазины (столбцы произвольно). 

Опишите принципы построения системы и их разграничение или разбивку между базами данных.

*Пришлите блоксхему, где и что будет располагаться. Опишите, в каких режимах будут работать сервера.* 

### Решение
<details>
  <sammary>Подробные сведения</sammary>

  - Горизонтальное шардирование:
    > **Этот вид подразумевает разделение хранилища на сгруппированные по каким-либо критериям строки. В этом случае каждый шард содержит одинаковые столбцы, но разные строки данных. Горизонтальное шардирование позволяет распределить нагрузку на запись и чтение данных между различными серверами, за каждый из которых отвечает отдельная машина.**
    > 
    > Например, мы знаем что у нас будет много книг и пользователей. поэтому заведем пару БД и будем просто равномерно распределять нагрузку по этим БД по какой-то хеш функции для определения, в какую шарду отправить каждую запись.
    > 
    > По итогу наши записи будут равномерно распределяться по базам данных.
    > ![image](https://github.com/ADNikulin/netology/assets/44374132/0e1c262a-f7cc-4919-83d8-361808a82978)
    > 
    > Как пример можно ещё добавить для пользователей и магазинов регионы и заниматься отправкой записей в нужную шарду по регионам записи.
    
  - Вертикальное шардирование:
    > **Такое шардирование предполагает разделение данных по столбцам. В этом случае каждый шард содержит часть столбцов массива и все связанные с ними строки данных. Вертикальное шардирование может быть полезно, когда некоторые столбцы используются чаще, а другие — реже. Это вид шардирования может использоваться в пределах одного сервера путем обновления оборудования.**
    > 
    > К примеру у нас большой массив данных с покупателями. Чтобы увеличить производительность, можно разделить его на два шарда, один из которых вмещает записи о клиентах, а другой — о товарах. При выполнении запросов будут загружаться только необходимые столбцы.\
    ![image](https://github.com/ADNikulin/netology/assets/44374132/73b3ebec-bfad-424d-bc26-4409571be5a8)

</details>

---

## Дополнительные задания (со звёздочкой*)
Эти задания дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже шире разобраться в материале.

---

### Задание 3* 

Опишите основные преимущества использования масштабирования методами:

- активный master-сервер и пассивный репликационный slave-сервер; 
- master-сервер и несколько slave-серверов;
- активный сервер со специальным механизмом репликации — distributed replicated block device (DRBD);
- SAN-кластер.

*Дайте ответ в свободной форме.*

### Решение 
<details>
  <summary>Показать подробности</summary>
  
  - Активный master-сервер и пассивный репликационный slave-сервер:
    > Высокая доступность: Мастер-сервер обеспечивает активное чтение и запись данных, а репликационные slave-серверы могут использоваться для балансировки нагрузки и отказоустойчивости.
    > 
    > Улучшенная производительность для чтения: При использовании репликационных серверов можно распределить нагрузку на чтение, что увеличивает производительность.
    > 
    > Резервное копирование: Репликационные серверы могут использоваться для резервного копирования без воздействия на мастер-сервер.
  - Master-сервер и несколько slave-серверов:
    > Высокая доступность и отказоустойчивость: Несколько репликационных slave-серверов обеспечивают увеличенную отказоустойчивость и улучшенную доступность.\
    > 
    > Балансировка нагрузки: Распределение запросов между несколькими slave-серверами позволяет улучшить производительность и балансировать нагрузку.
  - Активный сервер с DRBD:
    > Синхронная репликация: DRBD обеспечивает синхронную репликацию данных между активным сервером и пассивным сервером, что гарантирует целостность данных.
    > 
    > Высокая доступность: DRBD может использоваться для обеспечения отказоустойчивости и быстрого восстановления в случае сбоев.
  - SAN-кластер:
    > Централизованное хранилище: SAN-кластер предоставляет централизованное хранилище, что делает его удобным для больших и сложных сред.
    > Увеличение производительности: SAN-кластеры могут предоставлять высокую производительность благодаря использованию высокоскоростных соединений и хранилища.

</details>

---

### Задание 4*

Выполните настройку выбранных методов шардинга из задания 2.

*Пришлите конфиг Docker и SQL скрипт с командами для базы данных*.

---
